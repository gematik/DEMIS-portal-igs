@if (igsMeldungService.notificationUploads$ | async; as results) {
  <!-- REUSABLE ICON TEMPLATES -->
  <ng-template #meldungError let-rowNumber="rowNumber">
    @if(hasNotificationErrorData()) {
      <button id="results-btn-notification-error-{{ rowNumber }}" mat-icon-button class="error"
              title="Die Meldung konnte nicht übermittelt werden"
              (click)="onClickUploadError(rowNumber)">
        <mat-icon class="meldung_error">
          error
        </mat-icon>
      </button>
    }
    @else {
      <mat-icon class="meldung_error" title="Fehler sind aufgetreten.">
        error
      </mat-icon>
    }
  </ng-template>

  <ng-template #meldungSuccess>
    <mat-icon class="meldung_success" title="Meldung erfolgreich übermittelt">
      cloud_done
    </mat-icon>
  </ng-template>

  <ng-template #meldungAborted>
    <mat-icon class="meldung_aborted" title="Upload abgebrochen">
      file_upload_off
    </mat-icon>
  </ng-template>
  <!-- /REUSABLE ICON TEMPLATES -->

  <gem-demis-section-header titleText="Ergebnis" [level]="1">
    <p>Folgende Meldungen wurden übermittelt:</p>
  </gem-demis-section-header>

  <br /><br />

  <mat-table [dataSource]="toDataSource(results)" class="mat-elevation-z2" [id]="'results-table'">
    <!-- notification Definition -->
    <ng-container matColumnDef="notification">
      <mat-header-cell *matHeaderCellDef> Meldung übermittelt</mat-header-cell>
      <mat-cell *matCellDef="let row">
        @if (row.status === 'SUCCESS') {
          <ng-container *ngTemplateOutlet="meldungSuccess"></ng-container>
        }  @else if (row.status === 'ABORTED') {
          <ng-container *ngTemplateOutlet="meldungAborted"></ng-container>
        } @else {
          <ng-container *ngTemplateOutlet="meldungError; context: { rowNumber: row.rowNumber }"></ng-container>
        }
      </mat-cell>
    </ng-container>

    <!-- uploadTimestamp Definition -->
    <ng-container matColumnDef="uploadTimestamp">
      <mat-header-cell *matHeaderCellDef> Übertragungszeitpunkt</mat-header-cell>
      <mat-cell *matCellDef="let row">
        {{ (row.uploadTimestamp | date : 'dd.MM.yyyy HH:mm:ss') ?? '-' }}
      </mat-cell>
    </ng-container>

    <!-- demisNotificationId Definition -->
    <ng-container matColumnDef="demisNotificationId">
      <mat-header-cell *matHeaderCellDef> Meldungs-ID</mat-header-cell>
      <mat-cell *matCellDef="let row">
        {{ row.demisNotificationId ?? '-' }}
      </mat-cell>
    </ng-container>

    <!-- labSequenceId Definition -->
    <ng-container matColumnDef="labSequenceId">
      <mat-header-cell *matHeaderCellDef> Labor-ID</mat-header-cell>
      <mat-cell *matCellDef="let row">
        {{ row.labSequenceId ?? '-' }}
      </mat-cell>
    </ng-container>

    <!-- demisSequenceId Definition -->
    <ng-container matColumnDef="demisSequenceId">
      <mat-header-cell *matHeaderCellDef> IGS-ID</mat-header-cell>
      <mat-cell *matCellDef="let row">
        {{ row.demisSequenceId ?? '-' }}
      </mat-cell>
    </ng-container>


    <!-- Header and Row Declarations -->
    <mat-header-row
      *matHeaderRowDef="['notification', 'uploadTimestamp', 'demisNotificationId', 'labSequenceId', 'demisSequenceId']; sticky: true"></mat-header-row>
    <mat-row
      *matRowDef="let row; columns: ['notification', 'uploadTimestamp', 'demisNotificationId', 'labSequenceId', 'demisSequenceId']"></mat-row>
  </mat-table>
} @else {
  <gem-demis-section-header titleText="Keine Daten vorhanden" [level]="2">
    <p>Es sind keine Ergebnisdaten von IGS-Meldungen vorhanden.</p>
  </gem-demis-section-header>
}

<ng-template #resetBtn>
  <button id="btn-reset-flow" type="button" mat-stroked-button color="secondary" (click)="backToWelcome()">
    Prozess neu starten
  </button>
</ng-template>

<ng-template #downloadReportBtn>
  <button id="btn-report-download" [attr.demis-igs-filename]="resultReportFilename" type="button" mat-flat-button color="primary" (click)="downloadReport()">
    Report herunterladen
  </button>
</ng-template>

@if (!FEATURE_FLAG_PORTAL_IGS_SIDENAV) {
  <gem-demis-actions-bar>
    <ng-container *ngTemplateOutlet="resetBtn" actions-left></ng-container>
    <ng-container *ngTemplateOutlet="downloadReportBtn" actions-right></ng-container>
  </gem-demis-actions-bar>
}
@else {
  <ng-template #actionsLeft>
    <ng-container *ngTemplateOutlet="resetBtn"></ng-container>
  </ng-template>
  <ng-template #actionsRight>
    <ng-container *ngTemplateOutlet="downloadReportBtn"></ng-container>
  </ng-template>
}
